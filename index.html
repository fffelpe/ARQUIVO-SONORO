<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arquivo Sonoro - Busca</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f4;
            color: #333;
        }
        .container {
            max-width: 800px; /* Largura máxima do conteúdo */
            margin: 40px auto; /* Centraliza na página */
            background: #fff;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
            color: #111;
            margin-top: 0;
            margin-bottom: 30px;
            border-bottom: 1px solid #eee;
            padding-bottom: 15px;
        }
        #search-box {
            width: 100%;
            padding: 15px;
            font-size: 1.2em;
            border: 1px solid #ddd;
            border-radius: 5px;
            box-sizing: border-box; /* Para padding não aumentar a largura */
            margin-bottom: 20px;
        }
        #results {
            margin-top: 20px;
            border-top: 1px solid #eee;
            padding-top: 20px;
        }
        .result-item {
            margin-bottom: 15px;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 5px;
            border: 1px solid #eee;
        }
        .result-item a {
            text-decoration: none;
            color: #0056b3;
            font-weight: bold;
        }
        .result-item .type {
            font-size: 0.9em;
            color: #555;
            display: block; /* Para ficar em linha separada */
            margin-bottom: 5px;
        }
         .result-item .details {
            font-size: 0.9em;
            color: #444;
         }
        /* Mensagem quando não há resultados */
        #results:empty::before {
            content: "Nenhum resultado encontrado.";
            display: block;
            text-align: center;
            color: #888;
            font-style: italic;
        }
        /* Oculta a mensagem quando há resultados */
         #results:not(:empty)::before {
             display: none;
         }
    </style>
</head>
<body>
    <div class="container">
        <h1>Arquivo Sonoro</h1>
        <input type="search" id="search-box" placeholder="Buscar artista, álbum, gênero ou faixa...">
        <div id="results">
            </div>
    </div>

    <script>
        const searchBox = document.getElementById('search-box');
        const resultsContainer = document.getElementById('results');
        let searchData = []; // Para guardar os dados do JSON

        // 1. Carrega o índice de busca quando a página abre
        fetch('search_data.json') // Procura pelo arquivo na mesma pasta do index.html
            .then(response => {
                if (!response.ok) {
                    throw new Error(`Erro ao carregar o índice: ${response.statusText}`);
                }
                return response.json();
            })
            .then(data => {
                searchData = data;
                console.log(`Índice de busca carregado com ${searchData.length} itens.`);
            })
            .catch(error => {
                console.error('Falha ao carregar search_data.json:', error);
                resultsContainer.innerHTML = '<p style="color: red;">Erro ao carregar o índice de busca. Tente rodar o script gerador novamente.</p>';
            });

        // 2. Função para realizar a busca
        function performSearch() {
            const searchTerm = searchBox.value.toLowerCase().trim();
            resultsContainer.innerHTML = ''; // Limpa resultados anteriores

            if (!searchTerm || searchTerm.length < 2) { // Não busca com menos de 2 caracteres
                 // Se o campo estiver vazio, não mostramos a mensagem "Nenhum resultado"
                 if (!searchTerm) {
                     resultsContainer.style.borderTop = 'none'; // Esconde a linha divisória
                     resultsContainer.style.paddingTop = '0';
                 }
                return;
            }

             resultsContainer.style.borderTop = '1px solid #eee'; // Mostra a linha
             resultsContainer.style.paddingTop = '20px';

            const filteredResults = searchData.filter(item => {
                // Procura no nome (artista ou álbum)
                if (item.name && item.name.toLowerCase().includes(searchTerm)) return true;
                // Procura no nome do artista (para álbuns)
                if (item.artist && item.artist.toLowerCase().includes(searchTerm)) return true;
                // Procura no gênero
                if (item.genre && item.genre.toLowerCase().includes(searchTerm)) return true;
                // Procura nas faixas (se for um álbum)
                if (item.tracks && item.tracks.some(track => track.toLowerCase().includes(searchTerm))) return true;
                
                return false;
            });

            // 3. Exibe os resultados
            filteredResults.forEach(item => {
                const div = document.createElement('div');
                div.classList.add('result-item');

                let title = '';
                let details = item.genre ? `Gênero: ${item.genre}` : '';

                if (item.type === 'Artista') {
                    title = item.name;
                } else if (item.type === 'Álbum') {
                    title = `${item.artist} - ${item.name}`;
                     // Adiciona o número de faixas se houver
                     if (item.tracks && item.tracks.length > 0) {
                         details += ` (${item.tracks.length} faixas)`;
                     }
                }

                div.innerHTML = `
                    <span class="type">${item.type}</span>
                    <a href="${item.link}">${title}</a>
                    <div class="details">${details}</div>
                `;
                resultsContainer.appendChild(div);
            });

             // A mensagem "Nenhum resultado" é controlada pelo CSS :empty::before
        }

        // 4. Adiciona o listener para buscar enquanto digita (com um pequeno delay)
        let searchTimeout;
        searchBox.addEventListener('input', () => {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(performSearch, 300); // Espera 300ms após parar de digitar
        });

    </script>
</body>
</html>